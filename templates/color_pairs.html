<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>–¶–≤–µ—Ç–æ–≤—ã–µ –ø–∞—Ä—ã ‚Äî –ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fafafa;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    h1 {
      color: #4a148c;
    }

    .instructions {
      max-width: 600px;
      background-color: #fff3e0;
      border-left: 6px solid #ff9800;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .game-area {
      position: relative;
      width: 600px;
      height: 400px;
      border: 2px dashed #ccc;
      background-color: #f0f0f0;
      border-radius: 12px;
      overflow: hidden;
    }

    .emoji {
      position: absolute;
      font-size: 32px;
      cursor: pointer;
      user-select: none;
    }

    .btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #8a2be2;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }

    .btn:hover {
      background-color: #6d1cb3;
    }

    .btn-back {
      margin-top: 20px;
      text-decoration: none;
      font-weight: bold;
      color: #8a2be2;
    }
  </style>
</head>
<body>
  <h1>–¶–≤–µ—Ç–æ–≤—ã–µ –ø–∞—Ä—ã</h1>
  <div class="instructions">
    <p>–ü–æ–¥–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —ç–º–æ–¥–∂–∏, —â–µ–ª–∫–∞—è –ø–æ –Ω–∏–º. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–∞ –∏—Å—á–µ–∑–∞–µ—Ç. –ï—Å–ª–∏ –æ—à–∏–±—ë—Ç–µ—Å—å ‚Äî –∏–≥—Ä–∞ –Ω–∞—á–Ω—ë—Ç—Å—è –∑–∞–Ω–æ–≤–æ!</p>
  </div>

  <div class="game-area" id="gameArea"></div>
  <button class="btn" onclick="startGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  <a href="/" class="btn-back">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>

  <script>
    const emojis = ['üçé','üçå','üçá','üçì','üçí','üçç','ü•ù','ü••'];
    const gameArea = document.getElementById('gameArea');
    let elements = [];
    let selected = [];
    let interval;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    const csrftoken = getCookie('csrftoken');

    function awardPoints(points = 10) {
      fetch('/add_score/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
        body: JSON.stringify({ points: points })
      })
      .then(res => res.json())
      .then(data => console.log('–û—á–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω—ã:', data.new_score))
      .catch(err => console.error('–û—à–∏–±–∫–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤:', err));
    }

    function startGame() {
      clearInterval(interval);
      gameArea.innerHTML = '';
      selected = [];
      elements = [];

      const pool = [...emojis, ...emojis];
      shuffle(pool);

      pool.forEach(emoji => {
        const el = document.createElement('div');
        el.className = 'emoji';
        el.innerText = emoji;

        el.style.left = Math.random() * (gameArea.clientWidth - 32) + 'px';
        el.style.top = Math.random() * (gameArea.clientHeight - 32) + 'px';

        const dx = (Math.random() * 2 - 1) * 1.5;
        const dy = (Math.random() * 2 - 1) * 1.5;

        el.addEventListener('click', () => handleClick(el, emoji));
        gameArea.appendChild(el);
        elements.push({ el, emoji, dx, dy });
      });

      interval = setInterval(moveEmojis, 30);
    }

    function handleClick(el, emoji) {
      if (selected.includes(el)) return;

      el.style.transform = 'scale(1.3)';
      selected.push({ el, emoji });

      if (selected.length === 2) {
        if (selected[0].emoji === selected[1].emoji) {
          selected.forEach(s => s.el.remove());
          elements = elements.filter(e => e.el !== selected[0].el && e.el !== selected[1].el);

          if (elements.length === 0) {
            awardPoints(10);  // –Ω–∞—á–∏—Å–ª—è–µ–º 10 –æ—á–∫–æ–≤
            alert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ –≤—Å–µ –ø–∞—Ä—ã! üéâ');
          }
        } else {
          alert('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
          startGame();
        }
        selected = [];
      }
    }

    function moveEmojis() {
      elements.forEach(obj => {
        let x = obj.el.offsetLeft + obj.dx;
        let y = obj.el.offsetTop + obj.dy;

        if (x < 0 || x > gameArea.clientWidth - 32) obj.dx *= -1;
        if (y < 0 || y > gameArea.clientHeight - 32) obj.dy *= -1;

        obj.el.style.left = (obj.el.offsetLeft + obj.dx) + 'px';
        obj.el.style.top = (obj.el.offsetTop + obj.dy) + 'px';
      });
    }

    startGame();
  </script>
</body>
</html>